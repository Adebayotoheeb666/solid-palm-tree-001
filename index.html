<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Onboard-ticket</title>

    <!-- Critical performance optimizations -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="theme-color" content="#3839C9" />

    <!-- Favicon and manifest -->
    <link rel="icon" type="image/png" href="/onboard/logos-01.png" />

    <!-- DNS prefetch for external domains -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//fonts.gstatic.com" />

    <!-- Preconnect to font origins for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Preload critical fonts -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript
      ><link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
    /></noscript>

    <!-- Preload critical images -->
    <link
      rel="preload"
      href="/onboard/logos.png"
      as="image"
      type="image/png"
    />
    <link rel="preload" href="/hero.png" as="image" type="image/png" />

    <!-- Meta tags for SEO and performance -->
    <meta
      name="description"
      content="Get verified flight reservations instantly. OnboardTicket provides real, verifiable flight reservations for visa applications and travel needs."
    />
    <meta
      name="keywords"
      content="flight reservations, onward tickets, visa requirements, travel documents"
    />

    <!-- Disable unwanted features for performance -->
    <meta http-equiv="x-dns-prefetch-control" content="on" />

    <!-- Critical CSS (can be inlined later for even better performance) -->
    <style>
      /* Critical above-the-fold styles */
      html,
      body {
        margin: 0;
        padding: 0;
        font-family:
          "Plus Jakarta Sans",
          -apple-system,
          Roboto,
          Helvetica,
          sans-serif;
        background-color: #e7e9ff;
      }

      #root {
        min-height: 100vh;
      }

      /* Loading spinner for better UX */
      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #e7e9ff;
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3839c9;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Hide loading spinner when app is loaded */
      .app-loaded .loading-spinner {
        display: none;
      }
    </style>
  </head>

  <body>
    <div id="root">
      <!-- Loading spinner shown until React app loads -->
      <div class="loading-spinner">
        <div class="spinner"></div>
      </div>
    </div>

    <!-- Cache clearing utility for handling asset errors -->
    <script src="/clear-cache.js"></script>

    <script type="module" src="/client/App.tsx"></script>

    <!-- Performance monitoring script (optional) -->
    <script>
      // Mark when the page starts loading
      performance.mark("page-start");

      // Hide loading spinner when app is ready
      window.addEventListener("load", function () {
        document.body.classList.add("app-loaded");
        performance.mark("page-loaded");
      });

      // Global error handlers to prevent crashes
      window.addEventListener("error", function (e) {
        if (e.message && e.message.includes("Failed to fetch")) {
          console.warn("Fetch error caught and handled:", e.message);
          e.preventDefault();
          return false;
        }
      });

      window.addEventListener("unhandledrejection", function (e) {
        if (
          e.reason &&
          e.reason.message &&
          e.reason.message.includes("Failed to fetch")
        ) {
          console.warn(
            "Unhandled fetch rejection caught and handled:",
            e.reason.message,
          );
          e.preventDefault();
          return false;
        }
      });

      // Override fetch to add error handling
      const originalFetch = window.fetch;
      window.fetch = function (...args) {
        return originalFetch.apply(this, args).catch(function (error) {
          if (error.message && error.message.includes("Failed to fetch")) {
            console.warn("Fetch intercepted and handled:", error.message);
            // Return a fake response to prevent crashes
            return Promise.resolve(
              new Response('{"error": "Network error handled"}', {
                status: 500,
                headers: { "Content-Type": "application/json" },
              }),
            );
          }
          throw error;
        });
      };
    </script>
  </body>
</html>
